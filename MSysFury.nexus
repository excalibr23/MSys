{
    "type": "group",
    "name": "msysfury",
    "enabled": true,
    "id": 1,
    "items": [
        {
            "type": "function",
            "name": "onLoad",
            "enabled": true,
            "id": 2,
            "code": "MSys.SFCIversion = 1.4
MSys.SFCIrequiredCore = 1.4

if (MSys == undefined || MSys.coreVersion == undefined || MSys.coreVersion < MSys.SFCIrequiredCore) {
    display_notice('Starwraith Fury Combat Implant v' + MSys.SFCIversion + ' requires MSysCore v' + MSys.SFCIrequiredCore + ' or later','gold');
    return;
}

//Fury
MSys.shortname = 'SFCI'
MSys.stance = ''
MSys.bladeshape = false
MSys.rage = 0
MSys.maxRage = 0
MSys.unstoppable = false
MSys.berserk = false
MSys.useBerserk = get_variable('useBerserk')
MSys.fever = false
MSys.useFever = get_variable('useFever')
MSys.hypertension = false
MSys.infernoCharging = false
MSys.harden = false
MSys.warmth = false
MSys.balancing = false
MSys.firewreathe = false
MSys.flightCommand = 'KITH FLIGHT'
MSys.huntingAttack = function() {
    if (!MSys.systemEnabled) { return }
    
    //Fury
    var command = 'combo '

    if (MSys.interrupt && MSys.offenseEnabled) {
        send_command('kith fever ' + get_variable('tar'))
        return;
    }

    if (MSys.health / MSys.maxHealth < .8 && MSys.healReady  && MSys.useHeal) {
        send_command('kith suffuse')
        return;
    }else if (!MSys.bladeshape && get_variable('kithbladeshape') !== undefined && get_variable('kithbladeshape') !== '') {
        send_command(get_variable('kithbladeshape'))
        return;
    }else if (!MSys.harden)      { command = 'kith harden'
\t}else if (!MSys.warmth)      { command = 'kith warmth'
\t}else if (!MSys.balancing)   { command = 'kith balancing'
\t}else if (!MSys.firewreathe) { command = 'kith firewreathe'
    }else if (get_variable('tar') == '' || MSys.offenseEnabled == false) {
        return;
    }else if (!MSys.fever && MSys.useFever) {
        command = 'kith fever ';
    }else if (MSys.goal == 'hunt1') {
        //Battleflow attack
        if (MSys.stance == 'Symmetry') {
            command += 'swiftcut '
        } else if (MSys.stance == 'Flare') {
            command += 'wound '
        } else if (MSys.stance == 'Eruption') {
            if (MSys.hypertension) {
                command += 'bloodburn '
            } else {
                command += 'hypertension '
            }
        } else if (MSys.stance == 'Ember') {
            command += 'legspike '
        }

        //Rage Attack
        if (MSys.unstoppable) {
            command += 'slice '
        } else if (MSys.stance == 'Symmetry') {
            if (MSys.rage / MSys.maxRage > .13 && !MSys.berserk && MSys.useBerserk) {
                command += 'berserk '
            } else {
                command += 'flyinglash '
            }
        } else if (MSys.stance == 'Flare') {
            command += 'rend '
        } else if (MSys.stance == 'Eruption') {
            if (MSys.health / MSys.maxHealth < .7) {
                command += 'resistant '
            } else {
                command += 'upperlash '
            }
        } else if (MSys.stance == 'Ember') {
            if (MSys.rage / MSys.maxRage > .73  && MSys.unstoppable == false) {
                command += 'unstoppable '
            } else {
                command += 'strike '
            }
        }
    }else if (MSys.goal == 'hunt2') {
        //Battleflow attack
        if (MSys.stance == 'Symmetry') {
            command += 'swiftcut '
        } else if (MSys.stance == 'Flare') {
            command += 'wound '
        } else if (MSys.stance == 'Eruption') {
            command += 'rupture '
        }

        //Rage Attack
        if (MSys.unstoppable) {
            command += 'slice '
        } else if (MSys.stance == 'Symmetry') {
            if (MSys.rage / MSys.maxRage > .13 && !MSys.berserk && MSys.useBerserk) {
                command += 'berserk '
            } else {
                command += 'flyinglash '
            }
        } else if (MSys.stance == 'Flare') {
            command += 'rend '
        } else if (MSys.stance == 'Eruption') {
            if (MSys.rage / MSys.maxRage > .73  && MSys.unstoppable == false) {
                command += 'unstoppable '
            } else {
                command += 'strike '
            }
        }
    }else if (MSys.goal == 'hunt3') {
        var next = ''
        command = 'combo '

        //Battleflow attack
        if (MSys.stance == 'Symmetry') {
            command += 'gutrend '
            next = 'Ember'
        } else if (MSys.stance == 'Ember') {
            command += 'legspike '
            next = 'Symmetry'
        } else if (MSys.stance == 'Flare') {
            command += 'sear '
            next = 'Symmetry'
        }

        //Rage Attack
        if (MSys.unstoppable) {
            command += 'slice '
        } else if (next == 'Symmetry') {
            if (MSys.rage / MSys.maxRage > .8  && MSys.unstoppable == false) {
                command += 'unstoppable '
            } else {
                command += 'deflect '
            }
        } else if (next == 'Ember') {
            command += 'resistant '
        } else if (next == 'Flare') {
            command += 'reel '
        }
    }

    if (command[command.length - 1] == ' ') {
    \tcommand += get_variable('tar')
    }
    send_command(command)
}

MSys.loaded(\"Starwraith Fury Combat Implant v\" + MSys.SFCIversion + \" Loaded. See HFURY and HSETUP for config options. Good hunting, and good death.\");
send_command('wakeup')",
            "items": []
        },
        {
            "type": "function",
            "name": "onGMCP",
            "enabled": true,
            "id": 3,
            "code": "// Place any code here you'd like to run when a GMCP message is received
// - The GMCP message is received as \"args.gmcp_method\" and \"args.gmcp_args\"

GMCP[args.gmcp_method] = args.gmcp_args

/* ------------------------------------------ CHARACTER STUFF ----------------------------------- */

if (args.gmcp_method == \"Char.Vitals\") {

        MSys.stance = args.gmcp_args.st
        MSys.rage = args.gmcp_args.rg
        MSys.maxRage = args.gmcp_args.maxrg
}

/* -------------------------------------------- ITEMS IN ROOM ----------------------------------- */


//Add items when items enter
if (args.gmcp_method == \"Char.Items.Add\") {
    let itemJoining = args.gmcp_args['item']
    
    if (MSys.infernoCharging && itemJoining.attrib == 'm') {
    \tsend_command('asdf')
        MSys.infernoCharging = false
        MSys.alert('mob entered - inferno cancelled', 'white', 'red')
    }
}",
            "items": []
        },
        {
            "type": "group",
            "name": "Fury",
            "enabled": true,
            "id": 69,
            "items": [
                {
                    "type": "group",
                    "name": "Configuration",
                    "enabled": true,
                    "id": 144,
                    "items": [
                        {
                            "type": "alias",
                            "name": "hfury - Fury Abilities",
                            "enabled": true,
                            "id": 84,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": false,
                            "prefix_suffix": true,
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.notice(\"Commands:\", MSys.color.config)

var commands = ''
commands += 'hberserk - toggle using Berserk\\n'
commands += 'hfever - toggle using Fever\\n'
commands += 'hblade <shape> - set the desired Bladeshape\\n'

MSys.log(commands, 'white')

MSys.notice(\"Current settings:\", MSys.color.config)

var abilities = ''
abilities += 'Berserk: ' + get_variable('useBerserk') + '\\n'
abilities += 'Fever: ' + get_variable('useFever') + '\\n'
abilities += 'Heal: ' + get_variable('useHeal') + '\\n'
abilities += 'Bladeshape: ' + MSys.bladeshape + '\\n'
abilities += 'Desired blade shape set to: ' + get_variable('kithbladeshape') + '\\n'
abilities += 'Goal: ' + MSys.goal + '\\n'

MSys.log(abilities, 'white')"
                                }
                            ],
                            "text": "hfury",
                            "items": []
                        },
                        {
                            "type": "alias",
                            "name": "hberserk - Toggle Berserk ",
                            "enabled": true,
                            "id": 76,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": false,
                            "prefix_suffix": true,
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.useBerserk = MSys.toggle('useBerserk', 'Berserk');"
                                }
                            ],
                            "text": "hberserk",
                            "items": []
                        },
                        {
                            "type": "alias",
                            "name": "hfever - Toggle Fever",
                            "enabled": true,
                            "id": 80,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": false,
                            "prefix_suffix": true,
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.useFever = MSys.toggle('useFever', 'Fever');"
                                }
                            ],
                            "text": "hfever",
                            "items": []
                        },
                        {
                            "type": "alias",
                            "name": "hblade - Set Bladeshape",
                            "enabled": true,
                            "id": 121,
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "prefix_suffix": true,
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "set_variable('kithbladeshape', args[1])
MSys.notice('Set desired kithblade shape to: ' + get_variable('kithbladeshape'))"
                                }
                            ],
                            "text": "^hblade (.+)",
                            "items": []
                        }
                    ],
                    "actions": []
                },
                {
                    "type": "group",
                    "name": "Shortcuts",
                    "enabled": true,
                    "id": 145,
                    "items": [
                        {
                            "type": "alias",
                            "name": "Inferno - inf",
                            "enabled": true,
                            "id": 116,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": true,
                            "prefix_suffix": true,
                            "actions": [
                                {
                                    "action": "command",
                                    "command": "KITH INFERNO",
                                    "prefix_suffix": true
                                }
                            ],
                            "text": "inf",
                            "items": []
                        },
                        {
                            "type": "keybind",
                            "name": "",
                            "enabled": true,
                            "id": 117,
                            "key": 110,
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "var dt = new Date()
MSys.ttk = dt.getTime()

MSys.infernoCharging = true

send_command('KITH INFERNO')"
                                }
                            ],
                            "key_alt": false,
                            "key_ctrl": false,
                            "key_shift": false,
                            "items": []
                        },
                        {
                            "type": "keybind",
                            "name": "",
                            "enabled": true,
                            "id": 122,
                            "key": 106,
                            "actions": [
                                {
                                    "action": "command",
                                    "command": "KITH SUFFUSE"
                                }
                            ],
                            "key_alt": false,
                            "key_ctrl": false,
                            "key_shift": false,
                            "items": []
                        }
                    ],
                    "actions": []
                },
                {
                    "type": "group",
                    "name": "Ability Activations",
                    "enabled": true,
                    "id": 146,
                    "items": [
                        {
                            "type": "trigger",
                            "name": "Kithblade Shaped",
                            "enabled": true,
                            "id": 70,
                            "matching": "regexp",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "Resting your hand on the hilt of",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.bladeshape = true
if (MSys.systemEnabled === true) {
\tMSys.huntingAttack()
}"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Kithblade Unshaped",
                            "enabled": true,
                            "id": 86,
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "text": "The blade of .+ shimmers and warps.+",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.notice('Bladeshape Off', MSys.color.warning)
MSys.bladeshape = false

//var a = new Audio('https://freesound.org/people/Stopmotionbros/sounds/438991/download/438991__stopmotionbros__wind.m4a')
//a.play()"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Fever On",
                            "enabled": true,
                            "id": 79,
                            "matching": "regexp",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "Your mind extends towards the vulnerabilities of .+ body, and with your connection to the universe's energy, you begin to increase the heat in every cell, flushing .+ with a raging fever.",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.fever = true
MSys.interrupt = false"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Unstoppable On",
                            "enabled": true,
                            "id": 71,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "Your rage overwhelms you, you become unstoppable!",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.unstoppable = true
MSys.log('YES UNSTOPPABLE', MSys.color.info)

if (MSys.systemEnabled) {
\tMSys.huntingAttack()
}"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Unstoppable Off",
                            "enabled": true,
                            "id": 72,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "You no longer feel unstoppable!",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.unstoppable = false
MSys.log('NO UNSTOPPABLE', MSys.color.warning)

if (MSys.systemEnabled) {
\tMSys.huntingAttack()
}"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Hypertension On",
                            "enabled": true,
                            "id": 85,
                            "matching": "regexp",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "^Tossing .+ to your off hand, you extend a bloodied palm towards .+ and then clench it into a fist, feeling .+ heart spasm and beat more quickly within .+ chest.$",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.hypertension = true"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Heal Ready",
                            "enabled": true,
                            "id": 77,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "It is safe to suffuse yourself with kith energy again.",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.healReady = true

if (MSys.systemEnabled) {
\tMSys.huntingAttack()
}"
                                },
                                {
                                    "action": "highlight",
                                    "highlight": "line",
                                    "highlight_backref": "1",
                                    "highlight_fg": "#51d051",
                                    "highlight_bg": "#000000"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Heal Used",
                            "enabled": true,
                            "id": 78,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "The heart of distant stars and the fire at the center of every planet shimmers in your mind, and you draw upon that power, filling your body with an energy that heals your wounds and suffuses you with a flush of health.",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.healReady = false

if (MSys.systemEnabled) {
\tMSys.huntingAttack()
}"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Berserk On",
                            "enabled": true,
                            "id": 74,
                            "matching": "regexp",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "^You go berserk, flailing .*$",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.berserk = true

if (MSys.systemEnabled) {
\tMSys.huntingAttack()
}"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Berserk Off",
                            "enabled": true,
                            "id": 75,
                            "matching": "exact",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "You are no longer berserk.",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.berserk = false

if (MSys.systemEnabled) {
\tMSys.huntingAttack()
}"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Attack after Inferno",
                            "enabled": true,
                            "id": 118,
                            "matching": "substring",
                            "whole_words": true,
                            "case_sensitive": true,
                            "text": "The searing wave of your inferno engulfs",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.systemEnabled = true
MSys.offenseEnabled = true
MSys.infernoCharging = false

MSys.huntingAttack()"
                                }
                            ],
                            "items": []
                        },
                        {
                            "type": "trigger",
                            "name": "Harden On",
                            "enabled": true,
                            "id": 147,
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "text": "^You focus on hardening your skin with kith energy.$|^Your internals are already hardened.$|^That requires the Harden ability in the Fulmination skill, which you haven't learned.$",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.harden = true
MSys.huntingAttack()"
                                }
                            ]
                        },
                        {
                            "type": "trigger",
                            "name": "Warmth On",
                            "enabled": true,
                            "id": 148,
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "text": "^You focus on warming up your skin with kith energy.$|^You're already protected from being frozen.$|^That requires the Warmth ability in the Fulmination skill, which you haven't learned.$",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.warmth = true
MSys.huntingAttack()"
                                }
                            ]
                        },
                        {
                            "type": "trigger",
                            "name": "Balancing On",
                            "enabled": true,
                            "id": 149,
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "text": "^You focus on your kith to prevent falling.$|^You're already balancing.$|^That requires the Balancing ability in the Fulmination skill, which you haven't learned.$",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.balancing = true
MSys.huntingAttack()"
                                }
                            ]
                        },
                        {
                            "type": "trigger",
                            "name": "Fireweathe On",
                            "enabled": true,
                            "id": 150,
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "text": "^You form a wreathe of kith-induced fire around yourself.$|^You are already wreathed in fire.$|^That requires the Firewreathe ability in the Fulmination skill, which you haven't learned.$",
                            "actions": [
                                {
                                    "action": "script",
                                    "script": "MSys.firewreathe = true
MSys.huntingAttack()"
                                }
                            ]
                        }
                    ],
                    "actions": []
                },
                {
                    "type": "alias",
                    "name": "Awaken Fury",
                    "enabled": false,
                    "id": 143,
                    "matching": "exact",
                    "whole_words": true,
                    "case_sensitive": true,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "command",
                            "command": "kith harden",
                            "prefix_suffix": true
                        },
                        {
                            "action": "waitfor",
                            "text": "^You focus on hardening your skin|^Your internals are already hardened",
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "expire": "10"
                        },
                        {
                            "action": "command",
                            "command": "kith warmth",
                            "prefix_suffix": true
                        },
                        {
                            "action": "waitfor",
                            "text": "^You focus on warming up your skin|^You're already protected",
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "expire": "10"
                        },
                        {
                            "action": "command",
                            "command": "kith balancing",
                            "prefix_suffix": true
                        },
                        {
                            "action": "waitfor",
                            "text": "^You focus on your kith to prevent falling.|^You're already balancing",
                            "matching": "regexp",
                            "whole_words": false,
                            "case_sensitive": false,
                            "expire": "10"
                        },
                        {
                            "action": "command",
                            "command": "kith firewreathe",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "wakeup",
                    "items": []
                },
                {
                    "type": "trigger",
                    "name": "Queue Attack Fury",
                    "enabled": true,
                    "id": 73,
                    "matching": "regexp",
                    "whole_words": false,
                    "case_sensitive": true,
                    "text": "^You flow smoothly into the.+stance.+|^You flow out of your stance.+|^Your mind extends towards the vulnerabilities of.*$",
                    "actions": [
                        {
                            "action": "script",
                            "script": "MSys.huntingAttack()
"
                        }
                    ],
                    "items": []
                }
            ],
            "actions": []
        }
    ],
    "description": "Starwraith Fury Combat Implant v1.4"
}