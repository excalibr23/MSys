{
    "name": "starwraith trading implant",
    "enabled": true,
    "description": "v0.4",
    "type": "group",
    "id": 1,
    "items": [
        {
            "type": "function",
            "name": "onLoad",
            "enabled": true,
            "id": 2,
            "code": "//Commands to send on login

// Starwraith Trading Implant
STI = {
    version: 0.4,
    shortname: 'STI',
    packagename: 'starwraith trading implant',
    content: \"\",
    noticecolor: 'gold',
    // Parsing states
    state: 0,
    STATE_START: 0,
    STATE_HEADER: 1,
    STATE_DIVIDER: 2,
    STATE_CONTENT: 3,
    // Functions
    disableGroup: function(name) {
        var group = reflex_find_by_name('group', name, false, false, STI.packagename)
        reflex_disable(group)
    },
    enableGroup: function(name) {
        var group = reflex_find_by_name('group', name, false, false, STI.packagename)
        reflex_enable(group)
    },
    disable: function(name, type = 'group') {
        var group = reflex_find_by_name(type, name, false, false, STI.packagename)
        reflex_disable(group)
    },
    enable: function(name, type = 'group') {
        var group = reflex_find_by_name(type, name, false, false, STI.packagename)
        reflex_enable(group)
    },
    notice: function(text) {
        display_notice(\"[\" + STI.shortname + \"] \" + text, STI.noticecolor);
    },
    helpbox: function(title,text) {
        var helptext = \"<div class=\\\"mono\\\"><span style=\\\"color: #ffffff; \\\"><span style=\\\"background-color: #0000a0 \\\">\" + title + \"</span></span></div>\";
        helptext += \"<div class=\\\"mono\\\">\" + text.replace(\"\\n\",\"</div><div class=\\\"mono\\\">\") + \"</div>\";
        client.display_help_window(helptext);
\t},
    loaded: function() {
\t\tSTI.notice(\"Starwraith Trading Implant v\" + STI.version + \" Loaded. Use GETORDERS to download market orders.\\n\");// See TRADINGHELP for more information.\\n\");
    },
    escape: function(input) {
        if(input.indexOf(\" \")!=-1) {
            return \"\\\"\" + input.replace(\"\\\"\",\"\\\\\\\"\") + \"\\\"\";
        } 
        return input;
    },
    parse_order_line: function(input) {
        var id     = STI.escape(input.substring(0,6).trim());
        var cargo  = STI.escape(input.substring(6,22).trim());
        var qtytot = input.substring(22,38).split(\"/\");
        var qty    = STI.escape(qtytot[0].trim());
        var tot    = STI.escape(qtytot[1].trim());
        var dest   = STI.escape(input.substring(38,62).trim());
        var price  = STI.escape(input.substring(62,72).trim());
        var escrow = STI.escape(input.substring(72).trim());
        
        return id + \",\" + cargo  + \",\" + qty + \",\" + tot + \",\" + dest + \",\" + price  + \",\" + escrow;
\t},
    encode: function(input) {
        return input.replace(/[\\u00A0-\\u9999<>\\&]/gim, function(i) {
            return '&#'+i.charCodeAt(0)+';';
\t\t});
    },
    download: function(filename, text) {
  \t\tvar element = document.createElement('a');

    \telement.setAttribute('href', 'data:text/octet-stream,' + encodeURIComponent(text));
  \t\telement.setAttribute('download', filename);

  \t\telement.style.display = 'none';
  \t\tdocument.body.appendChild(element);

  \t\telement.click();
    
  \t\tdocument.body.removeChild(element);
\t}
}

STI.loaded();"
        },
        {
            "type": "group",
            "name": "Market Orders",
            "enabled": true,
            "id": 3,
            "items": [
                {
                    "type": "trigger",
                    "name": "Start Market Orders",
                    "enabled": false,
                    "id": 5,
                    "matching": "exact",
                    "whole_words": false,
                    "case_sensitive": false,
                    "text": "-------------------------------&lt; Market orders &gt;-------------------------------",
                    "actions": [
                        {
                            "action": "gag"
                        },
                        {
                            "action": "script",
                            "script": "STI.state = STI.STATE_HEADER;
STI.content = \"\";"
                        },
                        {
                            "action": "enable",
                            "type": "trigger",
                            "name": "Order Lines"
                        }
                    ]
                },
                {
                    "type": "trigger",
                    "name": "Order Lines",
                    "enabled": false,
                    "id": 7,
                    "matching": "regexp",
                    "whole_words": true,
                    "case_sensitive": true,
                    "text": ".*",
                    "actions": [
                        {
                            "action": "gag"
                        },
                        {
                            "action": "script",
                            "script": "switch (STI.state) {
    case STI.STATE_HEADER: // Parse the headers
        var values = args.input.replace(\"Quantity\",\"Quantity   Total\").split(/ {2,}/).join(\",\");
        STI.content += values + '\\n';
        
        STI.state = STI.STATE_DIVIDER;
    \tbreak;

    case STI.STATE_DIVIDER: // Ignore the first divider
        STI.state = STI.STATE_CONTENT;
    \tbreak;

    case STI.STATE_CONTENT:
        if (args.input.startsWith(\"Type MORE to continue reading.\")) {
            send_command('MORE');
        } else if (args.input.length < 72 || args.input.startsWith(\"[ Speed:\") ) {
            // Ignore
        } else if (args.input == \"-------------------------------------------------------------------------------\") {
            STI.state = STI.STATE_START;
            STI.disable('Order Lines','trigger'); // Stop capturing

            // Create a file to download
            STI.download(\"market_orders.csv\", STI.content);
            
            STI.notice(\"Done.\");
            
        } else {
            // Parse the content
            STI.content += STI.parse_order_line(args.input) + '\\n';
        }
    \tbreak;
        
  default:
}"
                        },
                        {
                            "action": "disable",
                            "type": "trigger",
                            "name": "Start Market Orders"
                        }
                    ]
                },
                {
                    "type": "alias",
                    "name": "getorders - Get Market Orders",
                    "enabled": true,
                    "id": 8,
                    "matching": "exact",
                    "whole_words": true,
                    "case_sensitive": false,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "script",
                            "script": "STI.notice(\"Getting market orders...\");"
                        },
                        {
                            "action": "enable",
                            "type": "trigger",
                            "name": "Start Market Orders"
                        },
                        {
                            "action": "command",
                            "command": "MARKET ORDER LIST",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "getorders"
                }
            ],
            "actions": []
        },
        {
            "type": "group",
            "name": "Shortcuts",
            "enabled": true,
            "id": 9,
            "items": [
                {
                    "type": "alias",
                    "name": "cca - Cargo Contents All",
                    "enabled": true,
                    "id": 11,
                    "matching": "exact",
                    "whole_words": true,
                    "case_sensitive": false,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "command",
                            "command": "CARGO CONTENTS ALL",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "cca"
                },
                {
                    "type": "alias",
                    "name": "mol <filter> - Market Order List",
                    "enabled": true,
                    "id": 10,
                    "matching": "exact",
                    "whole_words": true,
                    "case_sensitive": false,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "command",
                            "command": "MARKET ORDER LIST @filter",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "mol <filter>"
                },
                {
                    "type": "alias",
                    "name": "mot <id> <amt> - Market Order Take",
                    "enabled": true,
                    "id": 12,
                    "matching": "begins",
                    "whole_words": true,
                    "case_sensitive": true,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "command",
                            "command": "MARKET ORDER TAKE @id @amt",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "mot <id> <amt>"
                },
                {
                    "type": "alias",
                    "name": "mof <id> - Market Order Fulfill",
                    "enabled": true,
                    "id": 13,
                    "matching": "begins",
                    "whole_words": true,
                    "case_sensitive": true,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "command",
                            "command": "MARKET ORDER @id FULFILL",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "mof <id>"
                },
                {
                    "type": "alias",
                    "name": "mfl <filter> - Market Offer List",
                    "enabled": true,
                    "id": 14,
                    "matching": "begins",
                    "whole_words": true,
                    "case_sensitive": true,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "command",
                            "command": "MARKET OFFER LIST @filter",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "mfl <filter>"
                },
                {
                    "type": "alias",
                    "name": "mfb <n> <cargo> <max> - Market Offer Buy",
                    "enabled": true,
                    "id": 15,
                    "matching": "begins",
                    "whole_words": true,
                    "case_sensitive": true,
                    "prefix_suffix": true,
                    "actions": [
                        {
                            "action": "command",
                            "command": "MARKET BUY @n @cargo @max",
                            "prefix_suffix": true
                        }
                    ],
                    "text": "mfb <n> <cargo> <max>"
                }
            ],
            "actions": []
        },
        {
            "type": "group",
            "name": "Harvesting",
            "enabled": true,
            "id": 16,
            "items": [
                {
                    "type": "trigger",
                    "name": "",
                    "enabled": true,
                    "id": 17,
                    "matching": "begins",
                    "whole_words": true,
                    "case_sensitive": true,
                    "text": "The ship collects the surrounding <gas> into its scoops, bringing the collected total to <total>.",
                    "actions": [
                        {
                            "action": "highlight",
                            "highlight": "match",
                            "highlight_backref": "1",
                            "highlight_fg": "#ffff00",
                            "highlight_bg": "#000000"
                        },
                        {
                            "action": "highlight",
                            "highlight": "backref",
                            "highlight_backref": "1",
                            "highlight_fg": "#00f4ff",
                            "highlight_bg": "#000000"
                        }
                    ]
                }
            ],
            "actions": []
        },
        {
            "type": "alias",
            "name": "fc <tar> - Fire cannon",
            "enabled": true,
            "id": 18,
            "matching": "begins",
            "whole_words": true,
            "case_sensitive": true,
            "prefix_suffix": true,
            "actions": [
                {
                    "action": "command",
                    "command": "SHIP WEAPON FIRE CANNON <tar>",
                    "prefix_suffix": true
                }
            ],
            "text": "fire "
        }
    ]
}